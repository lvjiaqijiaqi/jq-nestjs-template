---
description: 
globs: 
alwaysApply: false
---
# API å¼€å‘è°ƒç”¨è§„èŒƒ

## ğŸŒ API åŸºç¡€ä¿¡æ¯

å‚è€ƒ [API_DOCUMENTATION.md](mdc:docs/API_DOCUMENTATION.md) è·å–å®Œæ•´APIæ–‡æ¡£ã€‚

### åŸºæœ¬é…ç½®

- **åŸºç¡€URL**: `http://localhost:3000` (å¼€å‘ç¯å¢ƒ)
- **APIå‰ç¼€**: `/api/v1`
- **æ–‡æ¡£åœ°å€**: `/api/docs` (Swagger UI)
- **è®¤è¯æ–¹å¼**: JWT Bearer Token
- **å†…å®¹ç±»å‹**: `application/json`

## ğŸ“‹ ç»Ÿä¸€å“åº”æ ¼å¼

### æˆåŠŸå“åº”ç»“æ„

```typescript
interface ResponseDto<T> {
  code: number;        // 200 = æˆåŠŸ
  message: string;     // å“åº”æ¶ˆæ¯
  data: T;            // å“åº”æ•°æ®
  timestamp: string;   // æ—¶é—´æˆ³
}
```

### åˆ†é¡µå“åº”ç»“æ„

```typescript
interface PaginatedResponseDto<T> {
  code: number;
  message: string;
  data: {
    items: T[];         // æ•°æ®åˆ—è¡¨
    total: number;      // æ€»è®°å½•æ•°
    page: number;       // å½“å‰é¡µç 
    pageSize: number;   // æ¯é¡µå¤§å°
    totalPages: number; // æ€»é¡µæ•°
  };
  timestamp: string;
}
```

## ğŸ” è®¤è¯æˆæƒ

### 1. ç”¨æˆ·ç™»å½•

```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
    "expiresIn": 900,
    "user": {
      "id": "uuid",
      "username": "admin",
      "nickname": "ç®¡ç†å‘˜"
    }
  }
}
```

### 2. è¯·æ±‚å¤´è®¤è¯

```http
GET /api/protected-endpoint
Authorization: Bearer <access_token>
Content-Type: application/json
```

### 3. åˆ·æ–°ä»¤ç‰Œ

```http
POST /api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
}
```

## ğŸ‘¤ ç”¨æˆ·ç®¡ç† API

### è·å–ç”¨æˆ·åˆ—è¡¨ (åˆ†é¡µ)

```http
GET /api/users?page=1&pageSize=10&keyword=john&status=ACTIVE
Authorization: Bearer <token>
```

### è·å–ç”¨æˆ·è¯¦æƒ…

```http
GET /api/users/{userId}
Authorization: Bearer <token>
```

### æ›´æ–°ç”¨æˆ·èµ„æ–™

```http
PUT /api/users/{userId}/profile
Authorization: Bearer <token>
Content-Type: application/json

{
  "nickname": "æ–°æ˜µç§°",
  "phone": "13800138000"
}
```

### ç®¡ç†å‘˜æ›´æ–°ç”¨æˆ·

```http
PUT /api/users/{userId}
Authorization: Bearer <token>
Content-Type: application/json

{
  "email": "new@example.com",
  "status": "ACTIVE",
  "roleId": "role-uuid"
}
```

## âŒ é”™è¯¯å¤„ç†

### é”™è¯¯ç è§„èŒƒ

é”™è¯¯ç æ ¼å¼: `AABBCC` (6ä½æ•°å­—)
- **AA**: æ¨¡å—ç¼–å· (10-99)
- **BB**: é”™è¯¯ç±»å‹ (00-99)  
- **CC**: å…·ä½“é”™è¯¯ (01-99)

### å¸¸ç”¨é”™è¯¯ç 

| é”™è¯¯ç  | HTTPçŠ¶æ€ | é”™è¯¯ä¿¡æ¯ | è¯´æ˜ |
|--------|----------|----------|------|
| 100001 | 404 | ç”¨æˆ·ä¸å­˜åœ¨ | ç”¨æˆ·æŸ¥è¯¢å¤±è´¥ |
| 100002 | 409 | ç”¨æˆ·åå·²å­˜åœ¨ | åˆ›å»ºç”¨æˆ·å†²çª |
| 200001 | 401 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ | ç™»å½•å‡­æ®æ— æ•ˆ |
| 200002 | 401 | è®¿é—®ä»¤ç‰Œå·²è¿‡æœŸ | éœ€è¦åˆ·æ–°ä»¤ç‰Œ |
| 300001 | 403 | è®¿é—®è¢«æ‹’ç» | æƒé™ä¸è¶³ |

### é”™è¯¯å“åº”ç¤ºä¾‹

```json
{
  "code": 100001,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨",
  "data": null,
  "timestamp": "2025-07-27T10:30:00.000Z",
  "path": "/api/v1/users/invalid-id"
}
```

## ğŸ“„ åˆ†é¡µæŸ¥è¯¢

### æ ‡å‡†åˆ†é¡µå‚æ•°

```typescript
interface PaginationDto {
  page?: number;          // é¡µç  (é»˜è®¤: 1)
  pageSize?: number;      // æ¯é¡µå¤§å° (é»˜è®¤: 10, æœ€å¤§: 100)
  sortBy?: string;        // æ’åºå­—æ®µ (é»˜è®¤: 'createdAt')
  sortOrder?: 'ASC'|'DESC'; // æ’åºæ–¹å‘ (é»˜è®¤: 'DESC')
}
```

### æŸ¥è¯¢ç¤ºä¾‹

```http
GET /api/users?page=2&pageSize=20&sortBy=username&sortOrder=ASC&keyword=admin
```

## ğŸ”§ ä¸šåŠ¡æ¨¡å— API

### å®¡è®¡æ—¥å¿— API

```http
# è·å–å®¡è®¡æ—¥å¿—
GET /api/audit-logs?page=1&pageSize=10&actionType=USER_LOGIN
Authorization: Bearer <token>

# è·å–ç”¨æˆ·æ“ä½œå†å²
GET /api/audit-logs/user/{userId}
Authorization: Bearer <token>
```

### ç¼“å­˜ç®¡ç† API

```http
# æ¸…é™¤æŒ‡å®šç¼“å­˜
DELETE /api/cache/{key}
Authorization: Bearer <token>

# è·å–ç¼“å­˜ç»Ÿè®¡
GET /api/cache/stats
Authorization: Bearer <token>
```

### é˜Ÿåˆ—ç®¡ç† API

```http
# è·å–é˜Ÿåˆ—çŠ¶æ€
GET /api/queues/status
Authorization: Bearer <token>

# æ·»åŠ é‚®ä»¶ä»»åŠ¡
POST /api/queues/email
Authorization: Bearer <token>
Content-Type: application/json

{
  "to": "user@example.com",
  "subject": "é‚®ä»¶ä¸»é¢˜",
  "template": "welcome",
  "context": { "username": "å¼ ä¸‰" }
}
```

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### ä½¿ç”¨ curl æµ‹è¯•

```bash
# 1. ç™»å½•è·å–token
TOKEN=$(curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.data.accessToken')

# 2. ä½¿ç”¨tokenè®¿é—®API
curl -X GET http://localhost:3000/api/users \
  -H "Authorization: Bearer $TOKEN"
```

### å‰ç«¯ JavaScript ç¤ºä¾‹

```javascript
// ç™»å½•
const login = async (username, password) => {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  return response.json();
};

// å¸¦è®¤è¯çš„APIè°ƒç”¨
const fetchUsers = async (token, page = 1) => {
  const response = await fetch(`/api/users?page=${page}`, {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  return response.json();
};
```

## ğŸ“Š æ¥å£æƒé™

### æƒé™çº§åˆ«

- **Public** ğŸŒ - æ— éœ€è®¤è¯
- **Authenticated** ğŸ”’ - éœ€è¦ç™»å½•  
- **Role-based** ğŸ‘® - åŸºäºè§’è‰²
- **Permission-based** ğŸ« - åŸºäºæƒé™

### æƒé™æ ‡è®°ç¤ºä¾‹

æŸ¥çœ‹å…·ä½“æ§åˆ¶å™¨æ–‡ä»¶äº†è§£æƒé™è¦æ±‚:
- [ç”¨æˆ·æ§åˆ¶å™¨](mdc:src/modules/user/controllers/user.controller.ts)
- [è®¤è¯æ§åˆ¶å™¨](mdc:src/modules/auth/controllers/auth.controller.ts)
