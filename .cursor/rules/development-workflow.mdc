---
description: 
globs: 
alwaysApply: false
---
# å¼€å‘å·¥ä½œæµè§„èŒƒ

## ğŸ“ ä»£ç è§„èŒƒ

å‚è€ƒ [DEVELOPMENT_GUIDE.md](mdc:docs/DEVELOPMENT_GUIDE.md) è·å–å®Œæ•´å¼€å‘è§„èŒƒã€‚

### TypeScript ç¼–ç è§„èŒƒ

```typescript
// âœ… æ¨èï¼šæ˜ç¡®çš„ç±»å‹å®šä¹‰
interface CreateUserDto {
  readonly username: string;
  readonly email: string;
  readonly password: string;
  readonly nickname?: string;
}

// âœ… æ¨èï¼šä½¿ç”¨æšä¸¾
enum UserStatus {
  ACTIVE = 'ACTIVE',
  INACTIVE = 'INACTIVE',
  SUSPENDED = 'SUSPENDED',
}

// âœ… æ¨èï¼šå¼‚æ­¥å‡½æ•°ç±»å‹æ ‡æ³¨
async function getUserById(id: string): Promise<User> {
  const user = await this.userRepository.findOne({ where: { id } });
  if (!user) {
    throw new NotFoundException('ç”¨æˆ·ä¸å­˜åœ¨');
  }
  return user;
}
```

### æ–‡ä»¶ç»„ç»‡è§„èŒƒ

```
æ¨¡å—ç›®å½•ç»“æ„:
your-module/
â”œâ”€â”€ controllers/          # HTTPæ§åˆ¶å™¨
â”‚   â””â”€â”€ your.controller.ts
â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â””â”€â”€ your.service.ts
â”œâ”€â”€ entities/            # æ•°æ®åº“å®ä½“
â”‚   â””â”€â”€ your.entity.ts
â”œâ”€â”€ dto/                 # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â””â”€â”€ your.dto.ts
â”œâ”€â”€ guards/              # æƒé™å®ˆå« (å¯é€‰)
â”‚   â””â”€â”€ your.guard.ts
â””â”€â”€ your.module.ts       # æ¨¡å—å®šä¹‰
```

## ğŸ”§ å¼€å‘å‘½ä»¤

### å¸¸ç”¨å¼€å‘å‘½ä»¤

```bash
# å¼€å‘æœåŠ¡å™¨
npm run start:dev          # å¯åŠ¨å¼€å‘æ¨¡å¼
npm run start:debug        # å¯åŠ¨è°ƒè¯•æ¨¡å¼
npm run build              # æ„å»ºé¡¹ç›®

# ä»£ç è´¨é‡
npm run lint               # ESLintæ£€æŸ¥
npm run lint:fix           # è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜
npm run format             # Prettieræ ¼å¼åŒ–

# æµ‹è¯•ç›¸å…³
npm run test               # è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:watch         # ç›‘å¬æ¨¡å¼æµ‹è¯•
npm run test:cov           # æµ‹è¯•è¦†ç›–ç‡
npm run test:e2e           # E2Eæµ‹è¯•

# æ•°æ®åº“ç›¸å…³
npm run migration:create   # åˆ›å»ºè¿ç§»æ–‡ä»¶
npm run migration:run      # æ‰§è¡Œè¿ç§»
npm run migration:revert   # å›æ»šè¿ç§»
npm run seed:auth          # å¯¼å…¥è®¤è¯ç§å­æ•°æ®
```

## ğŸ“ æ–°åŠŸèƒ½å¼€å‘æµç¨‹

### 1. åˆ›å»ºæ–°æ¨¡å—

```bash
# 1. åˆ›å»ºæ¨¡å—ç›®å½•
mkdir -p src/modules/your-module/{controllers,services,entities,dto}

# 2. åˆ›å»ºåŸºç¡€æ–‡ä»¶
touch src/modules/your-module/your-module.module.ts
touch src/modules/your-module/controllers/your.controller.ts
touch src/modules/your-module/services/your.service.ts
touch src/modules/your-module/entities/your.entity.ts
touch src/modules/your-module/dto/your.dto.ts
```

### 2. å®ä½“å®šä¹‰ (Entity)

```typescript
// src/modules/your-module/entities/your.entity.ts
import { Entity, PrimaryGeneratedColumn, Column } from 'typeorm';
import { BaseEntity } from '@/common/entities/base.entity';

@Entity('your_table')
export class YourEntity extends BaseEntity {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column({ length: 100 })
  name: string;

  @Column({ type: 'text', nullable: true })
  description?: string;
}
```

### 3. DTOå®šä¹‰ (Data Transfer Object)

```typescript
// src/modules/your-module/dto/your.dto.ts
import { IsString, IsOptional, MaxLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';
import { PaginationDto } from '@/common/dto/pagination.dto';

export class CreateYourDto {
  @ApiProperty({ description: 'åç§°' })
  @IsString()
  @MaxLength(100)
  name: string;

  @ApiProperty({ description: 'æè¿°', required: false })
  @IsOptional()
  @IsString()
  description?: string;
}

export class YourListDto extends PaginationDto {
  @ApiProperty({ description: 'æœç´¢å…³é”®è¯', required: false })
  @IsOptional()
  @IsString()
  keyword?: string;
}
```

### 4. æœåŠ¡å±‚ (Service)

```typescript
// src/modules/your-module/services/your.service.ts
import { Injectable } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { YourEntity } from '../entities/your.entity';
import { CreateYourDto, YourListDto } from '../dto/your.dto';

@Injectable()
export class YourService {
  constructor(
    @InjectRepository(YourEntity)
    private readonly yourRepository: Repository<YourEntity>,
  ) {}

  async create(createDto: CreateYourDto): Promise<YourEntity> {
    const entity = this.yourRepository.create(createDto);
    return this.yourRepository.save(entity);
  }

  async findAll(query: YourListDto): Promise<PaginatedResponseDto<YourEntity>> {
    const queryBuilder = this.yourRepository.createQueryBuilder('item');
    
    if (query.keyword) {
      queryBuilder.where('item.name LIKE :keyword', { 
        keyword: `%${query.keyword}%` 
      });
    }

    const [items, total] = await queryBuilder
      .skip(query.skip)
      .take(query.take)
      .getManyAndCount();

    return new PaginatedResponseDto(items, query.page, query.limit, total);
  }
}
```

### 5. æ§åˆ¶å™¨ (Controller)

```typescript
// src/modules/your-module/controllers/your.controller.ts
import { Controller, Get, Post, Body, Query } from '@nestjs/common';
import { ApiTags } from '@nestjs/swagger';
import { YourService } from '../services/your.service';
import { CreateYourDto, YourListDto } from '../dto/your.dto';
import { ApiDocumentation } from '@/common/decorators/api-documentation.decorator';
import { Auth } from '@/common/decorators/auth.decorator';

@ApiTags('your-module')
@Controller('your-module')
@Auth()
export class YourController {
  constructor(private readonly yourService: YourService) {}

  @Post()
  @ApiDocumentation('åˆ›å»ºé¡¹ç›®', 'YourEntity')
  async create(@Body() createDto: CreateYourDto) {
    return this.yourService.create(createDto);
  }

  @Get()
  @ApiDocumentation('è·å–é¡¹ç›®åˆ—è¡¨', 'PaginatedResponseDto<YourEntity>')
  async findAll(@Query() query: YourListDto) {
    return this.yourService.findAll(query);
  }
}
```

### 6. æ¨¡å—å®šä¹‰ (Module)

```typescript
// src/modules/your-module/your-module.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { YourController } from './controllers/your.controller';
import { YourService } from './services/your.service';
import { YourEntity } from './entities/your.entity';

@Module({
  imports: [TypeOrmModule.forFeature([YourEntity])],
  controllers: [YourController],
  providers: [YourService],
  exports: [YourService],
})
export class YourModule {}
```

## ğŸ—„ï¸ æ•°æ®åº“æ“ä½œ

### è¿ç§»æ–‡ä»¶ç®¡ç†

```bash
# åˆ›å»ºæ–°è¿ç§»
npm run migration:create -- --name AddYourTable

# æ‰§è¡Œè¿ç§»
npm run migration:run

# å›æ»šè¿ç§»
npm run migration:revert
```

### ç§å­æ•°æ®

```typescript
// database/seeds/your-seed.ts
import { DataSource } from 'typeorm';
import { YourEntity } from '@/modules/your-module/entities/your.entity';

export async function seedYourData(dataSource: DataSource) {
  const repository = dataSource.getRepository(YourEntity);
  
  const seedData = [
    { name: 'ç¤ºä¾‹1', description: 'ç¤ºä¾‹æè¿°1' },
    { name: 'ç¤ºä¾‹2', description: 'ç¤ºä¾‹æè¿°2' },
  ];

  for (const data of seedData) {
    const exists = await repository.findOne({ where: { name: data.name } });
    if (!exists) {
      await repository.save(repository.create(data));
    }
  }
}
```

## ğŸ§ª æµ‹è¯•ç¼–å†™

### å•å…ƒæµ‹è¯•

```typescript
// src/modules/your-module/services/your.service.spec.ts
import { Test, TestingModule } from '@nestjs/testing';
import { YourService } from './your.service';
import { Repository } from 'typeorm';
import { YourEntity } from '../entities/your.entity';

describe('YourService', () => {
  let service: YourService;
  let repository: Repository<YourEntity>;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        YourService,
        {
          provide: 'YourEntityRepository',
          useClass: Repository,
        },
      ],
    }).compile();

    service = module.get<YourService>(YourService);
    repository = module.get<Repository<YourEntity>>('YourEntityRepository');
  });

  it('should create item', async () => {
    // æµ‹è¯•å®ç°
  });
});
```

## ğŸ”’ æƒé™æ§åˆ¶

### ä½¿ç”¨æƒé™è£…é¥°å™¨

```typescript
import { Auth } from '@/common/decorators/auth.decorator';
import { RequirePermissions } from '@/common/decorators/permissions.decorator';
import { RequireRoles } from '@/common/decorators/roles.decorator';

@Controller('your-module')
@Auth() // éœ€è¦ç™»å½•
export class YourController {
  
  @Get()
  @RequirePermissions('your-module:read') // éœ€è¦ç‰¹å®šæƒé™
  async findAll() {}

  @Post()
  @RequireRoles('admin') // éœ€è¦ç‰¹å®šè§’è‰²
  async create() {}

  @Delete(':id')
  @RequirePermissions('your-module:delete')
  async remove() {}
}
```

## ğŸ“¦ æ¨¡å—æ³¨å†Œ

### åœ¨ä¸»æ¨¡å—ä¸­æ³¨å†Œ

```typescript
// src/app.module.ts
import { YourModule } from './modules/your-module/your-module.module';

@Module({
  imports: [
    // ... å…¶ä»–æ¨¡å—
    YourModule,
  ],
})
export class AppModule {}
```

## ğŸš€ éƒ¨ç½²å‰æ£€æŸ¥

### é¢„å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] è¿è¡Œæ‰€æœ‰æµ‹è¯•: `npm run test`
- [ ] æ£€æŸ¥ä»£ç è´¨é‡: `npm run lint`
- [ ] æ ¼å¼åŒ–ä»£ç : `npm run format`
- [ ] æ„å»ºé¡¹ç›®: `npm run build`
- [ ] æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- [ ] æ‰§è¡Œæ•°æ®åº“è¿ç§»
- [ ] æ›´æ–°APIæ–‡æ¡£

### å…³é”®é…ç½®æ–‡ä»¶

- **ç¯å¢ƒé…ç½®**: [.env.example](mdc:.env.example)
- **ESLinté…ç½®**: [.eslintrc.js](mdc:.eslintrc.js)
- **TypeScripté…ç½®**: [tsconfig.json](mdc:tsconfig.json)
- **åŒ…ç®¡ç†**: [package.json](mdc:package.json)
